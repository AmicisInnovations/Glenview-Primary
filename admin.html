<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glenview Primary</title>
    <script src="https://kit.fontawesome.com/4b08f514fc.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teachers:ital,wght@0,400..800;1,400..800&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Blaka+Hollow&family=Teachers:ital,wght@0,400..800;1,400..800&display=swap"
        rel="stylesheet">
        <link rel="icon" href="favicon.ico" type="image/x-icon" />
</head>
<body>
      <header class="nav-container">
    <nav class="nav-bar">
        <img src="images/logo-header.png" alt="Glenview" id="nav-logo">
    </nav>
    </header>
    <main class="main-container-admin">
  <h1>Administrator Dashboard</h1>
  <section id="admin-gallery">
  <h2>Gallery <i class="fa-regular fa-image"></i> </h2>
  <p><i class="fa-solid fa-upload"></i> Upload images below: </p>
  <input type="file" id="fileInput" />
  <button class="uploadBtn" id="uploadBtn-Gallery">Upload</button>
  <p id="status"></p>

  <h3>Files in Gallery</h3>
  <ul id="fileListGal"></ul>
  </section>
    <section id="admin-resources">
  <h2>Resources <i class="fa-regular fa-file"></i> </h2>
  <p><i class="fa-solid fa-upload"></i> Upload files below:</p>
  <input type="file" id="fileInput-Resources" />
        <select name="Resources" id="resources">
        <option value="" disabled selected>Resources...</option>
        <option value="newsletter" >Newsletters</option>
        <option value="exam-timetable" >Exam Timetables</option>
        <option value="what-to-learn" >What to Learns</option>
        <option value="stationery-list" >Stationery Lists</option>
      </select>
  <button class="uploadBtn" id="uploadBtn-Resources">Upload</button>
  <p id="status"></p>

  <h3>Files in Resources</h3>
  <ul id="fileList"></ul>
  </section>
  <section>
    <h2>Events</h2>
    <button id="create-event">Create Event</button>
      <dialog class="modal-event">
    <button class="close-btn">
      <i class="fa-solid fa-xmark"></i>
    </button>
    <h1>Create an event</h1>
    <section class="event-content">
      <label for="Name">Event Name:</label>
      <input type="text" id="eventName" name="event-name" required>

      <label for="Description">Event Description:</label>
      <textarea id="desc"></textarea>        

      <label for="Date">Date:</label>
      <input type="date" id="eventDate" name="event-date" required min="">

      <label for="start">Start Time:</label>
      <input type="time" id="start" name="start" min="08:00" max="20:00" required>

      <label for="end">End Time:</label>
      <input type="time" id="end" name="end" required>

    <label for="price">Event Price:</label>
    <input type="number" id="price" name="price" min="0" step="0.01" placeholder="Enter price">

    <section class="btn-container1">
      <button id="event-btn">CREATE EVENT</button>
    </section>
  </dialog>

    <h3>Upcoming Events:</h3>
  </section>
  </main>
  <footer>
        <section class="main-footer">
            <img src="images/logo-removebg-preview.png" alt="GPS" id="foot-logo">
        </section>
        <section class="amicis-footer">
            <p>© 2025 <a href="https://www.amicisinnovations.co.za/">Amicis Innovations</a>. All rights reserved.</p>
            <p>info@amicisinnovations.co.za</p>
        </section>
    </footer>
      <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script src="admin.js"></script>
  <script>
function getCurrentWeekKey() {
  const secret = "mySuperSecretSeed"; // keep this private
  const now = new Date();
  const weekNumber = Math.ceil((((now - new Date(now.getFullYear(), 0, 1)) / 86400000) + new Date(now.getFullYear(), 0, 1).getDay() + 1) / 7);
  return btoa(secret + "-" + now.getFullYear() + "-W" + weekNumber); // base64 encoded key
}

function checkAccess() {
  const params = new URLSearchParams(window.location.search);
  const key = params.get("key");
  const validKey = getCurrentWeekKey();
  
  if (key !== validKey) {
    document.body.innerHTML = "<h2>Access Denied</h2><p>Invalid or expired link.</p>";
    return false;
  }
  return true;
}

window.onload = function() {
  if (checkAccess()) {
    document.getElementById("admin-content").style.display = "block";
  }
};
</script>
<script>
    // --- 1️⃣ Initialize Supabase ---
    const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // --- 2️⃣ Fetch event details ---
    async function fetchEvents() {
      const { data, error } = await supabase
        .from('YOUR_TABLE_NAME') // replace with your table name
        .select('event_name, cost, date, time, description');

      if (error) {
        console.error("Error fetching events:", error);
        document.getElementById("event-container").textContent = "Error loading events.";
        return;
      }

      // --- 3️⃣ Display the events ---
      if (data.length === 0) {
        document.getElementById("event-container").textContent = "No events found.";
        return;
      }

      let html = "<table border='1' cellpadding='8' style='border-collapse: collapse;'>";
      html += "<tr><th>Event</th><th>Description</th><th>Date</th><th>Time</th><th>Cost</th></tr>";

      data.forEach(event => {
        html += `
          <tr>
            <td>${event.event_name}</td>
            <td>${event.description || '-'}</td>
            <td>${event.date || '-'}</td>
            <td>${event.time || '-'}</td>
            <td>${event.cost || '-'}</td>
          </tr>
        `;
      });

      html += "</table>";
      document.getElementById("event-container").innerHTML = html;
    }

    fetchEvents();
  </script>
</body>
</html>

